10 REM ALMANAC
20 REM COMPLETE CELESTIAL NAVIGATION CALCULATOR
30 PRINT CHR$(14):REM SWITCH TO UPPERCASE MODE
35 PRINT:PRINT:PRINT:PRINT:PRINT
40 PRINT "SUN SIGHT REDUCTION"
70 INPUT "YEAR (1980-2099)";YR
80 INPUT "MONTH (1-12)";MO
90 INPUT "DAY (1-31)";DY
100 INPUT "HOUR UT (0-23)";HR
110 INPUT "MINUTE UT (0-59)";MN
130 INPUT "YOUR LATITUDE (+ N, - S)";LAT
140 INPUT "YOUR LONGITUDE (+ E, - W)";LON
160 INPUT "OBSERVED ALTITUDE Ho (DEG)";HOD
170 INPUT "OBSERVED ALTITUDE Ho (MIN)";HOM
180 HO=HOD+HOM/60
200 REM CALCULATE JULIAN DATE
210 A=INT((14-MO)/12)
220 Y=YR+4800-A
230 M=MO+12*A-3
240 JD=DY+INT((153*M+2)/5)+365*Y
250 JD=JD+INT(Y/4)-INT(Y/100)+INT(Y/400)-32045
260 REM ADD TIME FRACTION
270 T=(JD+(HR+MN/60)/24-2451545)/36525
280 REM SUN MEAN LONGITUDE
290 L0=280.46646+36000.76983*T+.0003032*T*T
300 L0=L0-INT(L0/360)*360
310 IF L0<0 THEN L0=L0+360
320 REM SUN MEAN ANOMALY
330 MA=357.52911+35999.05029*T-.0001537*T*T
340 MA=MA-INT(MA/360)*360
350 IF MA<0 THEN MA=MA+360
360 MR=MA*.0174532925
370 REM EQUATION OF CENTER
380 C=(1.914602-.004817*T-.000014*T*T)*SIN(MR)
390 C=C+(.019993-.000101*T)*SIN(2*MR)
400 C=C+.000289*SIN(3*MR)
410 REM TRUE LONGITUDE
420 TL=L0+C
430 REM NUTATION
440 OM=125.04-1934.136*T
450 LA=TL-.00569-.00478*SIN(OM*.0174532925)
460 REM OBLIQUITY
470 EP=23.439291-.0130042*T
480 EP=EP+.00256*COS(OM*.0174532925)
490 EPR=EP*.0174532925
500 LAR=LA*.0174532925
510 REM RIGHT ASCENSION
520 RA=ATN(COS(EPR)*SIN(LAR)/COS(LAR))
530 RA=RA*57.2957795
540 IF COS(LAR)<0 THEN RA=RA+180
550 IF RA<0 THEN RA=RA+360
560 REM GREENWICH MEAN SIDEREAL TIME
570 GM=280.46061837+360.98564736629*(JD+(HR+MN/60)/24-2451545)
580 GM=GM+.000387933*T*T-T*T*T/38710000
590 GM=GM-INT(GM/360)*360
600 IF GM<0 THEN GM=GM+360
610 REM GREENWICH HOUR ANGLE
620 GH=GM-RA
630 IF GH<0 THEN GH=GH+360
640 REM CALCULATE DECLINATION
650 DECR=ATN(SIN(EPR)*SIN(LAR)/SQR(1-(SIN(EPR)*SIN(LAR))^2))
660 DEC=DECR*57.2957795
670 REM CALCULATE LOCAL HOUR ANGLE
680 LHA=GH-LON
690 IF LHA<0 THEN LHA=LHA+360
700 IF LHA>=360 THEN LHA=LHA-360
710 REM SIGHT REDUCTION - CALCULATE Hc
720 LATR=LAT*.0174532925
730 LHAR=LHA*.0174532925
740 SINHS=SIN(LATR)*SIN(DECR)+COS(LATR)*COS(DECR)*COS(LHAR)
750 HC=ATN(SINHS/SQR(1-SINHS*SINHS))*57.2957795
760 REM CALCULATE AZIMUTH
770 COSZ=(SIN(DECR)-SIN(LATR)*SINHS)/(COS(LATR)*COS(HC*.0174532925))
780 IF COSZ>1 THEN COSZ=1
790 IF COSZ<-1 THEN COSZ=-1
800 ZN=ATN(SQR(1-COSZ*COSZ)/COSZ)*57.2957795
810 IF COSZ<0 THEN ZN=180-ZN
820 REM ADJUST AZIMUTH FOR QUADRANT
830 IF LHA>180 THEN ZN=360-ZN
840 REM CALCULATE INTERCEPT
850 INT=HO-HC
860 REM DISPLAY RESULTS
880 PRINT "DATE: ";MO;"/";DY;"/";YR;" ";
890 IF HR<10 THEN PRINT "0";
900 PRINT HR;":";
910 IF MN<10 THEN PRINT "0";
920 PRINT MN;" UT"
930 PRINT "POS: ";LAT;CHR$(248);" ";LON;CHR$(248)
960 REM FORMAT GHA
970 GD=INT(GH)
980 GM=INT((GH-GD)*60)
990 GS=INT(((GH-GD)*60-GM)*60)
1000 PRINT "SUN GHA: ";GD;CHR$(248);
1010 IF GM<10 THEN PRINT "0";
1020 PRINT GM;"'";
1030 IF GS<10 THEN PRINT "0";
1040 PRINT GS;CHR$(34)
1050 REM FORMAT DECLINATION
1060 DD=INT(ABS(DEC))
1070 DM=INT((ABS(DEC)-DD)*60)
1080 DS=INT(((ABS(DEC)-DD)*60-DM)*60)
1090 PRINT "SUN DEC: ";
1100 IF DEC<0 THEN PRINT "S ";:GOTO 1120
1110 PRINT "N ";
1120 PRINT DD;CHR$(248);
1130 IF DM<10 THEN PRINT "0";
1140 PRINT DM;"'";
1150 IF DS<10 THEN PRINT "0";
1160 PRINT GS;CHR$(34)
1180 REM FORMAT LHA
1190 LD=INT(LHA)
1200 LM=INT((LHA-LD)*60)
1210 PRINT "LHA: ";LD;CHR$(248);
1220 IF LM<10 THEN PRINT "0";
1230 PRINT LM;"'"
1260 PRINT "SIGHT REDUCTION RESULTS:"
1280 REM FORMAT Hc
1290 HCD=INT(HC)
1300 HCM=INT((HC-HCD)*60)
1310 HCS=INT(((HC-HCD)*60-HCM)*60)
1320 PRINT "Hc (COMPUTED): ";HCD;CHR$(248);
1330 IF HCM<10 THEN PRINT "0";
1340 PRINT HCM;"'";
1350 IF HCS<10 THEN PRINT "0";
1360 PRINT HCS;CHR$(34)
1370 REM FORMAT Ho
1380 PRINT "Ho (OBSERVED): ";HOD;CHR$(248);
1390 IF HOM<10 THEN PRINT "0";
1400 PRINT HOM;"'"
1420 REM FORMAT INTERCEPT
1430 INTD=INT(ABS(INT))
1440 INTM=INT((ABS(INT)-INTD)*60)
1450 PRINT "INTERCEPT: ";INTD;"' ";
1460 IF INTM>0 THEN PRINT INTM;CHR$(34);" ";
1470 IF INT>0 THEN PRINT "TOWARD"
1480 IF INT<0 THEN PRINT "AWAY"
1490 IF INT=0 THEN PRINT "ON"
1510 REM FORMAT AZIMUTH
1520 ZD=INT(ZN)
1530 ZM=INT((ZN-ZD)*60)
1540 PRINT "AZIMUTH: ";ZD;CHR$(248);
1550 IF ZM<10 THEN PRINT "0";
1560 PRINT ZM;"' T"
1580 PRINT "PLOT LOP FROM YOUR POSITION:"
1590 PRINT "BEARING ";ZD;CHR$(248);" FOR ";
1600 IF INT>0 THEN PRINT INTD;"' TOWARD SUN"
1610 IF INT<0 THEN PRINT INTD;"' AWAY FROM SUN"
1620 IF INT=0 THEN PRINT "EXACTLY ON LOP"
1640 INPUT "ANOTHER SIGHT (Y/N)";A$
1650 IF A$="Y" OR A$="y" THEN GOTO 30
1660 END